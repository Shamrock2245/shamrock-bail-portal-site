import { geocodeAddressToCityStateZip, reverseGeocodeToCityStateZip } from 'backend/googleMaps';

/**
 * Verify Google Maps API Key Configuration
 * Run this function directly in the Wix Editor (click the green Play icon)
 */
export async function verifyMapsConfiguration() {
    console.log("üó∫Ô∏è Starting Google Maps API Verification...");
    const results = {
        geocoding: { success: false, message: '' },
        reverseGeocoding: { success: false, message: '' },
        overallSuccess: false
    };

    try {
        // 1. Test Geocoding (Address -> Coords -> Details)
        console.log("üìç Testing Geocoding...");
        const address = "1600 Amphitheatre Parkway, Mountain View, CA";
        const geoResult = await geocodeAddressToCityStateZip(address);

        if (geoResult.city === 'Mountain View' && geoResult.state === 'CA') {
            results.geocoding.success = true;
            results.geocoding.message = "‚úÖ Geocoding working. Correctly identified Mountain View, CA.";
        } else {
            results.geocoding.message = `‚ùå Geocoding returned unexpected data: ${JSON.stringify(geoResult)}`;
        }

        // 2. Test Reverse Geocoding (Coords -> Address)
        console.log("üìç Testing Reverse Geocoding...");
        // Shamrock Bail Bonds (approximate coords for test or generic US location)
        // Let's use the Googleplex coords again: 37.4221, -122.0841
        const lat = 37.4221;
        const lng = -122.0841;

        const reverseResult = await reverseGeocodeToCityStateZip(lat, lng);

        if (reverseResult.city === 'Mountain View' && reverseResult.state === 'CA') {
            results.reverseGeocoding.success = true;
            results.reverseGeocoding.message = "‚úÖ Reverse Geocoding working. Correctly identified Mountain View, CA.";
        } else {
            results.reverseGeocoding.message = `‚ùå Reverse Geocoding returned unexpected data: ${JSON.stringify(reverseResult)}`;
        }

        // Final Verdict
        if (results.geocoding.success && results.reverseGeocoding.success) {
            results.overallSuccess = true;
            console.log("‚úÖ SUCCESS: Google Maps is fully configured.");
        } else {
            console.error("‚ùå FAILURE: Google Maps configuration has issues.");
        }

        return results;

    } catch (error) {
        console.error("üí• Critical Error during verification:", error);
        return {
            success: false,
            error: error.message,
            hint: "Check 'GOOGLE_MAPS_API_KEY' in Secrets Manager and ensure Geocoding API is enabled in Google Cloud Console."
        };
    }
}
